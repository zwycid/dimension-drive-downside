package lk.summer.project.background;

import java.util.Random;

import lk.summer.project.lkcustom.LKAndroid;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Point;
import android.graphics.Rect;
import android.view.SurfaceHolder;

public class LKThreadFallingText extends Thread implements Runnable {

	private Random random;
	private Paint paint;

	private int[] text_speed_x;
	private int[] text_speed_y;
	private Point[] text_pt;
	
	private SurfaceHolder holder;
	private Canvas canvas;
	
	public void run() {
		random			= new Random();
		paint				= new Paint();

		text_speed_x		= new int[textImageArray.length];
		text_speed_y		= new int[textImageArray.length];
		text_pt			= new Point[textImageArray.length];
		
		holder	= this.getHolder();
		//src는 원래 이미지의 크기, dest는 실제 그릴 그림의 크기입니다.

		for(int i = 0 ; i < textImageArray.length ; i++){
			//일단 겹침 없이 출력되는 걸로
			text_speed_x[i]	= (this.getWidth() / THE_NUMBER_OF_FALLING_TEXT) * i;
			text_speed_y[i]	= Math.abs(random.nextInt() % FALLING_TEXT_MAX_SPEED) + FALLING_TEXT_MIN_SPEED;

			text_pt[i]	= new Point(text_speed_x[i], -1 * textHeightArray[i]);
		}

		Bitmap background	= BitmapFactory.decodeResource(getResources(),LKAndroid.getID("drawable", "blackimage"));
		Rect rectangleForBGI	= new Rect(0, 0, getWidth(), getHeight());

		while(thread != null){
			//double buffering
			//allocate canvas of holder to variable canvas
			canvas	= holder.lockCanvas();
			canvas.drawBitmap(background, null, rectangleForBGI, null);

			for(int i = 0 ; i < textImageArray.length ; i++)
				canvas.drawBitmap(textImageArray[i], text_pt[i].x, text_pt[i].y, paint);

			//완료된 화변 canvas를 현재 화면(holder)에 할당
			holder.unlockCanvasAndPost(canvas);

			for(int i = 0 ; i != textImageArray.length ; i++){
				if(text_pt[i].y > this.getHeight())
					text_pt[i].y	= -1 * textHeightArray[i];
				text_pt[i].y	+= text_speed_y[i];
			}
		}
	}
	
	public void initialize(){
		
	}

	public LKThreadFallingText(Runnable runnable) {
		super(runnable);
		
		
	}
	
	
}
